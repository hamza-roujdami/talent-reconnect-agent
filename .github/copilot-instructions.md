# Copilot Instructions

- **Purpose & stack**: Multi-agent recruiting demo built on Microsoft Agent Framework (MAF) with Azure AI Search as the knowledge source. Orchestrator routes to Profile (RoleCrafter), Search (TalentScout), Insights (InsightPulse), and Outreach (ConnectPilot) agents. Entries: [chat_multi.py](../chat_multi.py) for CLI, [main.py](../main.py) + [api/routes.py](../api/routes.py) + [static/index.html](../static/index.html) for FastAPI + SSE UI.
- **Source of truth**: Use Microsoft Learn under Azure AI Foundry or Microsoft Agent Framework for docs. Use code from the `microsoft/agent-framework` repo only. If something is missing outside those sources, ask before using anything else.
- **Agent wiring**: Agents and handoff rules live in [agents/factory.py](../agents/factory.py). Orchestrator is a silent router (no text output) and only calls handoff tools. ProfileAgent collects role spec; SearchAgent uses Azure AI Search context; InsightsAgent reads interview feedback; OutreachAgent drafts emails. Do not let orchestrator call business tools directly—keep tools on domain agents.
- **Search tools**: Resume lookup is in [tools/candidate_search.py](../tools/candidate_search.py) (`search_candidates` tool) and feedback is in [tools/feedback_lookup.py](../tools/feedback_lookup.py). The multi-agent workflow uses tool-based search for reliable handoff routing. Keep temps low and prompts tight per agent.
- **Config & secrets**: Runtime config is in [config.py](../config.py) using `.env`. `.env.example` defaults both `AZURE_SEARCH_MODE` and `AZURE_FEEDBACK_MODE` to `agentic`. Real creds stay in `.env` (ignored in [.gitignore](../.gitignore)). Key envs: `FOUNDRY_CHAT_ENDPOINT`, `FOUNDRY_MODEL_PRIMARY` (or `FOUNDRY_MODEL_FAST`), `SEARCH_SERVICE_ENDPOINT`, `SEARCH_SERVICE_API_KEY`, `SEARCH_RESUME_INDEX`, `SEARCH_FEEDBACK_INDEX`, optional KB names.
- **Data bootstrap**: All Azure AI Search setup lives in [data/](../data/README.md). Typical flow: `python data/01-create-index.py`, `python data/02-push-data.py --count 100000`, optional feedback index `python data/03-create-feedback-index.py` + `python data/04-push-feedback-data.py`. Harnesses to validate modes: `data/05-resumes-semantic-harness.py`, `06` agentic, `07` feedback semantic, `08` feedback agentic.
- **Running & testing**: Create venv, `pip install -r requirements.txt`, copy `.env.example` to `.env`. CLI: `python chat_multi.py` (multi-agent chat). API/UI: `python main.py` then open `http://localhost:8000`. Scripted demo: `PYTHONPATH=$(pwd) ./.venv/bin/python tests/demo_test.py` (harnessed, deterministic flow). Interactive REPL: `python tests/test_workflow.py`.
- **UI streaming behavior**: [api/routes.py](../api/routes.py) streams SSE events (`agent`, `tool`, `tool_result`, `text`) and suppresses chatter/routing phrases. History is kept per session (in-memory). Pending requests expire after 2 minutes; handoff requests are pruned before reuse.
- **Patterns & conventions**: Keep tool outputs deterministic and concise; avoid emojis in orchestrator messages (routing-only). Attach tools to the relevant agent (e.g., `send_outreach_email` only on OutreachAgent). Maintain agent names consistent with UI labels in [api/routes.py](../api/routes.py) to keep SSE rendering intact. Use `HandoffBuilder` for routing—don’t bypass it with ad-hoc calls.
- **Model tiering**: Orchestrator is low-temp; domain agents inherit chat client defaults. Agentic retrieval uses Foundry/Azure OpenAI deployment set in env; semantic fallback works without KB name.
- **Troubleshooting**: If agentic harnesses return no context, verify KB names and Foundry endpoint/deployment are set. If imports fail in tests, set `PYTHONPATH=$(pwd)` before running. Aiohttp may warn about unclosed sessions on shutdown; harmless for demos.
