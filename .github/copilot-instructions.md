# Copilot Instructions

- **Purpose & stack**: Multi-agent recruiting demo built on Azure AI Foundry SDK v2 with Foundry IQ Knowledge Bases. Orchestrator routes to Profile (RoleCrafter), Search (TalentScout), Insights (InsightPulse), Outreach (ConnectPilot), and Research (MarketRadar) agents. Entries: [chat_multi.py](../chat_multi.py) for CLI, [main.py](../main.py) + [api/routes.py](../api/routes.py) + [static/index.html](../static/index.html) for FastAPI + SSE UI.
- **Source of truth**: Use Microsoft Learn under Azure AI Foundry for docs. If something is missing outside those sources, ask before using anything else.
- **Agent wiring**: Agents and handoff rules live in [agents/factory.py](../agents/factory.py). Orchestrator is a silent router (no text output). ProfileAgent collects role spec; TalentScout uses Foundry IQ `resumes-kb` via MCPTool; InsightPulse uses `feedback-kb`; OutreachAgent drafts emails; MarketRadar uses web search. Keep tools on domain agents, not orchestrator.
- **Foundry IQ**: Resume and feedback search use MCPTool with Knowledge Bases created via [data/09-create-knowledge-bases.py](../data/09-create-knowledge-bases.py). MCP connections created via [data/10-create-mcp-connections.py](../data/10-create-mcp-connections.py). Knowledge Bases use `retrievalReasoningEffort: minimal`.
- **Config & secrets**: Runtime config is in [config.py](../config.py) using `.env`. Real creds stay in `.env` (ignored in [.gitignore](../.gitignore)). Key envs: `PROJECT_ENDPOINT`, `FOUNDRY_MODEL_PRIMARY`, `AZURE_SEARCH_ENDPOINT`, `RESUMES_KB_NAME`, `FEEDBACK_KB_NAME`, `RESUMES_KB_CONNECTION`, `FEEDBACK_KB_CONNECTION`.
- **Data bootstrap**: All Azure AI Search setup lives in [data/](../data/README.md). Typical flow: `python data/01-create-index.py`, `python data/02-push-data.py --count 100000`, `python data/03-create-feedback-index.py`, `python data/04-push-feedback-data.py`, `python data/09-create-knowledge-bases.py`, `python data/10-create-mcp-connections.py`.
- **Running & testing**: Create venv, `pip install -r requirements.txt`, copy `.env.example` to `.env`. CLI: `python chat_multi.py`. API/UI: `python main.py` then open `http://localhost:8000`. Tests: `pytest tests/test_foundry_iq.py -v`.
- **UI streaming behavior**: [api/routes.py](../api/routes.py) streams SSE events (`agent`, `tool`, `tool_result`, `text`). History is kept per session via Cosmos DB (falls back to in-memory).
- **Patterns & conventions**: Keep tool outputs deterministic and concise. Attach tools to the relevant agent (e.g., `send_outreach_email` only on OutreachAgent). Maintain agent names consistent with UI labels in [api/routes.py](../api/routes.py).
- **Troubleshooting**: If KB search returns no results, verify KB names, MCP connections, and `retrievalReasoningEffort: minimal` is set. If imports fail in tests, set `PYTHONPATH=$(pwd)` before running.
